{"version":3,"sources":["../src/createRenderer.js"],"names":["codeRenderer","createRenderer","tracker","options","CodeComponent","props","createElement","className","language","dangerouslySetInnerHTML","highlight","__html","code","elementId","nextElementId","elements","key","tree","push","overrides","renderer","Renderer","getTocPosition","toc","level","currentLevel","children","length","populateInlineContent","content","contentArray","split","extractedElements","map","elementIdMatch","text","match","splice","indexOf","decode","addElement","tag","type","inlineContent","elementType","Array","isArray","Object","assign","context","html","paragraph","blockquote","link","href","title","br","hr","strong","del","em","heading","currentId","slice","replace","toLowerCase","id","join","lastToc","tocPosition","list","body","ordered","listitem","table","header","thead","tbody","tablerow","tablecell","flag","align","undefined","codespan","image","src","alt"],"mappings":"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","file":"createRenderer.js","sourcesContent":["import marked from 'marked';\nimport he from 'he';\n\nexport function codeRenderer(tracker, options) {\n  function CodeComponent(props) {\n    return options.createElement(\n      'pre',\n      null,\n      // eslint-disable-next-line react/no-danger-with-children\n      options.createElement(\n        'code',\n        {\n          className: `language-${props.language}`,\n          dangerouslySetInnerHTML: options.highlight\n            ? { __html: options.highlight(props.language, props.code) }\n            : null,\n        },\n        options.highlight ? null : props.code\n      )\n    );\n  }\n\n  return (code, language) => {\n    // eslint-disable-next-line no-plusplus, no-param-reassign\n    const elementId = tracker.nextElementId++;\n\n    // eslint-disable-next-line no-param-reassign\n    tracker.elements[elementId] = options.createElement(\n      (options.elements && options.elements.code) || CodeComponent,\n      { key: elementId, code, language }\n    );\n\n    tracker.tree.push(tracker.elements[elementId]);\n\n    return `{{${elementId}}}`;\n  };\n}\n\nexport default function createRenderer(tracker, options, overrides = {}) {\n  const renderer = new marked.Renderer();\n\n  function getTocPosition(toc, level) {\n    let currentLevel = toc.children;\n\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      if (!currentLevel.length || currentLevel[currentLevel.length - 1].level === level) {\n        return currentLevel;\n      }\n      currentLevel = currentLevel[currentLevel.length - 1].children;\n    }\n  }\n\n  function populateInlineContent(content = '') {\n    const contentArray = content.split(/(\\{\\{.*?\\}\\})/);\n    const extractedElements = contentArray.map(text => {\n      const elementIdMatch = text.match(/\\{\\{(.*)\\}\\}/);\n      if (elementIdMatch) {\n        tracker.tree.splice(tracker.tree.indexOf(tracker.elements[elementIdMatch[1]]), 1);\n        return tracker.elements[elementIdMatch[1]];\n      } else if (text !== '') {\n        return he.decode(text);\n      }\n\n      return null;\n    });\n\n    return extractedElements;\n  }\n\n  function addElement(tag, props = {}, children, type = tag) {\n    // eslint-disable-next-line no-plusplus, no-param-reassign\n    const elementId = tracker.nextElementId++;\n    let inlineContent = null;\n\n    const elementType = options.elements && options.elements[type];\n\n    if (children) {\n      inlineContent = Array.isArray(children)\n        ? children.map(populateInlineContent)\n        : populateInlineContent(children);\n    }\n\n    // eslint-disable-next-line no-param-reassign\n    tracker.elements[elementId] = options.createElement(\n      elementType || tag,\n      Object.assign(\n        {\n          key: elementId,\n        },\n        props,\n        elementType ? { context: tracker.context } : {}\n      ),\n      inlineContent\n    );\n\n    tracker.tree.push(tracker.elements[elementId]);\n\n    return `{{${elementId}}}`;\n  }\n\n  renderer.code = overrides.code || codeRenderer(tracker, options);\n\n  renderer.html =\n    overrides.html ||\n    (html => {\n      // eslint-disable-next-line no-plusplus, no-param-reassign\n      const elementId = tracker.nextElementId++;\n\n      tracker.tree.push(\n        options.createElement('div', {\n          key: elementId,\n          dangerouslySetInnerHTML: {\n            __html: html,\n          },\n        })\n      );\n    });\n\n  renderer.paragraph = overrides.paragraph || (text => addElement('p', null, text));\n\n  renderer.blockquote = overrides.blockquote || (text => addElement('blockquote', null, text));\n\n  renderer.link = overrides.link || ((href, title, text) => addElement('a', { href, title }, text));\n\n  renderer.br = overrides.br || (() => addElement('br'));\n\n  renderer.hr = overrides.hr || (() => addElement('hr'));\n\n  renderer.strong = overrides.strong || (text => addElement('strong', null, text));\n\n  renderer.del = overrides.del || (text => addElement('del', null, text));\n\n  renderer.em = overrides.em || (text => addElement('em', null, text));\n\n  renderer.heading =\n    overrides.heading ||\n    ((text, level) => {\n      // eslint-disable-next-line no-param-reassign\n      tracker.currentId = tracker.currentId.slice(0, level - 1);\n      tracker.currentId.push(text.replace(/\\s/g, '-').toLowerCase());\n\n      const id = tracker.currentId.join('-');\n      const lastToc = tracker.toc[tracker.toc.length - 1];\n\n      if (!lastToc || lastToc.level > level) {\n        tracker.toc.push({\n          id,\n          title: text,\n          level,\n          children: [],\n        });\n      } else {\n        const tocPosition = getTocPosition(lastToc, level);\n\n        tocPosition.push({\n          id,\n          title: text,\n          level,\n          children: [],\n        });\n      }\n\n      return addElement(\n        `h${level}`,\n        {\n          id,\n        },\n        text\n      );\n    });\n\n  renderer.list =\n    overrides.list || ((body, ordered) => addElement(ordered ? 'ol' : 'ul', null, body));\n\n  renderer.listitem = overrides.listitem || (text => addElement('li', null, text));\n\n  renderer.table =\n    overrides.table ||\n    ((header, body) =>\n      addElement('table', null, [\n        addElement('thead', null, header),\n        addElement('tbody', null, body),\n      ]));\n\n  renderer.thead = overrides.thead || (content => addElement('thead', null, content));\n\n  renderer.tbody = overrides.tbody || (content => addElement('tbody', null, content));\n\n  renderer.tablerow = overrides.tablerow || (content => addElement('tr', null, content));\n\n  renderer.tablecell =\n    overrides.tablecell ||\n    ((content, flag) => {\n      const tag = flag.header ? 'th' : 'td';\n      return addElement(tag, { className: flag.align ? `text-${flag.align}` : undefined }, content);\n    });\n\n  renderer.codespan = overrides.codespan || (text => addElement('code', null, text, 'codespan'));\n\n  renderer.image =\n    overrides.image || ((href, title, text) => addElement('img', { src: href, alt: text }));\n\n  return renderer;\n}\n"]}