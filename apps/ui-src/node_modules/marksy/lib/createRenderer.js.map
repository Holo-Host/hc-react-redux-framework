{"version":3,"sources":["../src/createRenderer.js"],"names":["codeRenderer","createRenderer","tracker","options","CodeComponent","props","children","createElement","className","language","dangerouslySetInnerHTML","highlight","__html","code","e","console","warn","elementId","nextElementId","elements","key","tree","push","overrides","renderer","marked","Renderer","getTocPosition","toc","level","currentLevel","length","populateInlineContent","content","contentArray","split","extractedElements","map","elementIdMatch","text","match","splice","indexOf","he","decode","addElement","tag","type","inlineContent","elementType","Array","isArray","Object","assign","context","html","paragraph","blockquote","link","href","title","br","hr","strong","del","em","heading","currentId","slice","replace","toLowerCase","id","join","lastToc","tocPosition","list","body","ordered","listitem","table","header","thead","tbody","tablerow","tablecell","flag","align","undefined","codespan","image","src","alt"],"mappings":"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","file":"createRenderer.js","sourcesContent":["import marked from 'marked';\nimport he from 'he';\n\nexport function codeRenderer(tracker, options) {\n  function CodeComponent(props) {\n    let children;\n    try {\n      // eslint-disable-next-line react/no-danger-with-children\n      children = options.createElement(\n        'code',\n        {\n          className: `language-${props.language}`,\n          dangerouslySetInnerHTML: options.highlight\n            ? { __html: options.highlight(props.language, props.code) }\n            : null,\n        },\n        options.highlight ? null : props.code\n      );\n    } catch (e) {\n      // eslint-disable-next-line\n      console.warn(`${props.language} is not supported by your defined highlighter.`);\n      children = options.createElement('code', null, props.code);\n    }\n\n    return options.createElement('pre', null, children);\n  }\n\n  return (code, language) => {\n    // eslint-disable-next-line no-plusplus, no-param-reassign\n    const elementId = tracker.nextElementId++;\n\n    // eslint-disable-next-line no-param-reassign\n    tracker.elements[elementId] = options.createElement(\n      (options.elements && options.elements.code) || CodeComponent,\n      { key: elementId, code, language }\n    );\n\n    tracker.tree.push(tracker.elements[elementId]);\n\n    return `{{${elementId}}}`;\n  };\n}\n\nexport default function createRenderer(tracker, options, overrides = {}) {\n  const renderer = new marked.Renderer();\n\n  function getTocPosition(toc, level) {\n    let currentLevel = toc.children;\n\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      if (!currentLevel.length || currentLevel[currentLevel.length - 1].level === level) {\n        return currentLevel;\n      }\n      currentLevel = currentLevel[currentLevel.length - 1].children;\n    }\n  }\n\n  function populateInlineContent(content = '') {\n    const contentArray = content.split(/(\\{\\{.*?\\}\\})/);\n    const extractedElements = contentArray.map(text => {\n      const elementIdMatch = text.match(/\\{\\{(.*)\\}\\}/);\n      if (elementIdMatch) {\n        tracker.tree.splice(tracker.tree.indexOf(tracker.elements[elementIdMatch[1]]), 1);\n        return tracker.elements[elementIdMatch[1]];\n      } else if (text !== '') {\n        return he.decode(text);\n      }\n\n      return null;\n    });\n\n    return extractedElements;\n  }\n\n  function addElement(tag, props = {}, children, type = tag) {\n    // eslint-disable-next-line no-plusplus, no-param-reassign\n    const elementId = tracker.nextElementId++;\n    let inlineContent = null;\n\n    const elementType = options.elements && options.elements[type];\n\n    if (children) {\n      inlineContent = Array.isArray(children)\n        ? children.map(populateInlineContent)\n        : populateInlineContent(children);\n    }\n\n    // eslint-disable-next-line no-param-reassign\n    tracker.elements[elementId] = options.createElement(\n      elementType || tag,\n      Object.assign(\n        {\n          key: elementId,\n        },\n        props,\n        elementType ? { context: tracker.context } : {}\n      ),\n      inlineContent\n    );\n\n    tracker.tree.push(tracker.elements[elementId]);\n\n    return `{{${elementId}}}`;\n  }\n\n  renderer.code = overrides.code || codeRenderer(tracker, options);\n\n  renderer.html =\n    overrides.html ||\n    (html => {\n      // eslint-disable-next-line no-plusplus, no-param-reassign\n      const elementId = tracker.nextElementId++;\n\n      tracker.tree.push(\n        options.createElement('div', {\n          key: elementId,\n          dangerouslySetInnerHTML: {\n            __html: html,\n          },\n        })\n      );\n    });\n\n  renderer.paragraph = overrides.paragraph || (text => addElement('p', null, text));\n\n  renderer.blockquote = overrides.blockquote || (text => addElement('blockquote', null, text));\n\n  renderer.link = overrides.link || ((href, title, text) => addElement('a', { href, title }, text));\n\n  renderer.br = overrides.br || (() => addElement('br'));\n\n  renderer.hr = overrides.hr || (() => addElement('hr'));\n\n  renderer.strong = overrides.strong || (text => addElement('strong', null, text));\n\n  renderer.del = overrides.del || (text => addElement('del', null, text));\n\n  renderer.em = overrides.em || (text => addElement('em', null, text));\n\n  renderer.heading =\n    overrides.heading ||\n    ((text, level) => {\n      // eslint-disable-next-line no-param-reassign\n      tracker.currentId = tracker.currentId.slice(0, level - 1);\n      tracker.currentId.push(text.replace(/\\s/g, '-').toLowerCase());\n\n      const id = tracker.currentId.join('-');\n      const lastToc = tracker.toc[tracker.toc.length - 1];\n\n      if (!lastToc || lastToc.level > level) {\n        tracker.toc.push({\n          id,\n          title: text,\n          level,\n          children: [],\n        });\n      } else {\n        const tocPosition = getTocPosition(lastToc, level);\n\n        tocPosition.push({\n          id,\n          title: text,\n          level,\n          children: [],\n        });\n      }\n\n      return addElement(\n        `h${level}`,\n        {\n          id,\n        },\n        text\n      );\n    });\n\n  renderer.list =\n    overrides.list || ((body, ordered) => addElement(ordered ? 'ol' : 'ul', null, body));\n\n  renderer.listitem = overrides.listitem || (text => addElement('li', null, text));\n\n  renderer.table =\n    overrides.table ||\n    ((header, body) =>\n      addElement('table', null, [\n        addElement('thead', null, header),\n        addElement('tbody', null, body),\n      ]));\n\n  renderer.thead = overrides.thead || (content => addElement('thead', null, content));\n\n  renderer.tbody = overrides.tbody || (content => addElement('tbody', null, content));\n\n  renderer.tablerow = overrides.tablerow || (content => addElement('tr', null, content));\n\n  renderer.tablecell =\n    overrides.tablecell ||\n    ((content, flag) => {\n      const tag = flag.header ? 'th' : 'td';\n      return addElement(tag, { className: flag.align ? `text-${flag.align}` : undefined }, content);\n    });\n\n  renderer.codespan = overrides.codespan || (text => addElement('code', null, text, 'codespan'));\n\n  renderer.image =\n    overrides.image || ((href, title, text) => addElement('img', { src: href, alt: text }));\n\n  return renderer;\n}\n"]}